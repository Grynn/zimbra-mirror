<?xml version="1.0" encoding="UTF-8"?>
<install4j version="4.1.4" transformSequenceNumber="2">
  <directoryPresets config="./build/dist/jetty/common/lib" />
  <application name="Yahoo! Zimbra Desktop" distributionSourceDir="" applicationId="4062-5711-9195-4050" mediaDir="./install4j" mediaFilePattern="${compiler:sys.shortName}_${compiler:sys.platform}_${compiler:sys.version}" compression="6" lzmaCompression="true" pack200Compression="true" excludeSignedFromPacking="true" keepModificationTimes="true" shortName="zdesktop" publisher="Yahoo! Inc" publisherWeb="www.zimbra.com" version="0.90" allPathsRelative="true" backupOnSave="false" autoSave="true" convertDotsToUnderscores="true" macSignature="ZIMD" installerName="Zimbra Desktop Installer" javaMinVersion="1.5" javaMaxVersion="1.6" allowBetaVM="true" jdkMode="runtimeJre" jdkName="">
    <languages skipLanguageSelection="false">
      <principalLanguage id="en_US" customLocalizationFile="./src/installer/messages/ZiMsg.properties" />
      <additionalLanguages>
        <language id="es_ES" customLocalizationFile="./src/installer/messages/ZiMsg_es.properties" />
        <language id="sv" customLocalizationFile="./src/installer/messages/ZiMsg_sv.properties" />
        <language id="zh_CN" customLocalizationFile="./src/installer/messages/ZiMsg_zh_CN.properties" />
        <language id="zh_HK" customLocalizationFile="./src/installer/messages/ZiMsg_zh_HK.properties" />
        <language id="en_GB" customLocalizationFile="./src/installer/messages/ZiMsg_en_GB.properties" />
        <language id="en_AU" customLocalizationFile="./src/installer/messages/ZiMsg_en_AU.properties" />
        <language id="pt_BR" customLocalizationFile="./src/installer/messages/ZiMsg_pt_BR.properties" />
        <language id="pl" customLocalizationFile="./src/installer/messages/ZiMsg_pl.properties" />
        <language id="ru" customLocalizationFile="./src/installer/messages/ZiMsg_ru.properties" />
        <language id="ko" customLocalizationFile="./src/installer/messages/ZiMsg_ko.properties" />
        <language id="ja" customLocalizationFile="./src/installer/messages/ZiMsg_ja.properties" />
        <language id="it" customLocalizationFile="./src/installer/messages/ZiMsg_it.properties" />
        <language id="de" customLocalizationFile="./src/installer/messages/ZiMsg_de.properties" />
        <language id="fr" customLocalizationFile="./src/installer/messages/ZiMsg_fr.properties" />
        <language id="nl" customLocalizationFile="./src/installer/messages/ZiMsg_nl.properties" />
        <language id="da" customLocalizationFile="./src/installer/messages/ZiMsg_da.properties" />
      </additionalLanguages>
    </languages>
    <searchSequence>
      <registry />
      <envVar name="JAVA_HOME" />
      <envVar name="JDK_HOME" />
    </searchSequence>
    <variables>
      <variable name="offline_channel" value="alpha" />
      <variable name="offline_relabel" value="ALPHA" />
      <variable name="offline_version" value="0.1" />
      <variable name="offline_buildid" value="1" />
      <variable name="offline_ausurl" value="https://www.zimbra.com/aus/zdesktop/update.php" />
      <variable name="offline_update" value="false" />
      <variable name="offline_ausurl_dev" value="http://devel.zimbra.com/aus/desktop/nightly/update.php" />
    </variables>
  </application>
  <files>
    <filesets />
    <roots />
    <mountPoints>
      <mountPoint id="66" root="" location="jetty" mode="755" />
      <mountPoint id="239" root="" location="conf" mode="755" />
      <mountPoint id="240" root="" location="db" mode="755" />
      <mountPoint id="429" root="" location="log" mode="755" />
      <mountPoint id="430" root="" location="redolog" mode="755" />
      <mountPoint id="814" root="" location="lib" mode="755" />
      <mountPoint id="842" root="" location="store" mode="755" />
      <mountPoint id="843" root="" location="index" mode="755" />
      <mountPoint id="856" root="" location="zimlets" mode="755" />
      <mountPoint id="181400" root="" location="win32" mode="755" />
      <mountPoint id="181402" root="" location="macos" mode="755" />
      <mountPoint id="181404" root="" location="linux" mode="755" />
      <mountPoint id="235368" root="" location="zdesktop.webapp" mode="755" />
      <mountPoint id="271586" root="" location="profile" mode="755" />
      <mountPoint id="285127" root="" location="wiki" mode="755" />
      <mountPoint id="4668" root="" location="" mode="755" />
      <mountPoint id="290057" root="" location="zimlets-deployed" mode="755" />
    </mountPoints>
    <entries>
      <dirEntry mountPoint="66" file="./build/dist/jetty" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="*.zgz" dirMode="755">
        <exclude>
          <entry location="lib/ext" fileType="regular" />
          <entry location="webapps/zimbra/help/webhelp.jar" fileType="regular" />
        </exclude>
      </dirEntry>
      <dirEntry mountPoint="239" file="./build/dist/conf" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="240" file="./build/dist/db" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="814" file="./build/dist/lib" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="856" file="./build/dist/zimlets" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="181400" file="./build/dist/win32" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="181402" file="./build/dist/macos" overwrite="1" shared="false" mode="755" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="181404" file="./build/dist/linux" overwrite="1" shared="false" mode="755" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="235368" file="./build/dist/zdesktop.webapp" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="271586" file="./build/dist/profile" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <dirEntry mountPoint="285127" file="./build/dist/wiki" overwrite="1" shared="false" mode="644" uninstallMode="2" excludeSuffixes="" dirMode="755">
        <exclude />
      </dirEntry>
      <fileEntry mountPoint="4668" file="./build/dist/README.txt" overwrite="1" shared="false" mode="644" uninstallMode="2" />
    </entries>
    <components />
  </files>
  <launchers>
    <launcher name="Yahoo! Zimbra Desktop Service" id="32" external="false" excludeFromMenu="true" menuName="" icnsFile="" pngIcon16File="./src/installer/resources/launcher_16x16.png" pngIcon32File="./src/installer/resources/launcher_32x32.png" macServiceDependencies="" swtApp="false" fileset="">
      <executable name="zdesktop" type="1" iconSet="false" iconFile="" executableDir="." redirectStderr="true" stderrFile="log/zdesktop.out" redirectStdout="true" stdoutFile="log/zdesktop.out" failOnStderrOutput="true" executableMode="3" changeWorkingDirectory="true" workingDirectory="log" singleInstance="true" serviceStartType="2" serviceDependencies="" serviceDescription="Yahoo! Zimbra Desktop Service" jreLocation="" executionLevel="asInvoker">
        <versionInfo include="false" fileVersion="" fileDescription="" legalCopyright="" internalName="" />
      </executable>
      <splashScreen show="false" autoOff="true" alwaysOnTop="true" width="0" height="0" bitmapFile="" java6SplashScreen="false">
        <text>
          <statusLine x="20" y="20" text="" font="Arial" fontSize="8" fontColor="0,0,0" fontWeight="500" />
          <versionLine x="20" y="40" text="version ${compiler:sys.version}" font="Arial" fontSize="8" fontColor="0,0,0" fontWeight="500" />
        </text>
      </splashScreen>
      <java mainClass="com.zimbra.cs.offline.start.Main" vmParameters="-server -Djava.awt.headless=true -Xms24m -Xmx100m -Xss180k -XX:+AggressiveOpts -XX:MinHeapFreeRatio=20 -XX:MaxHeapFreeRatio=40 -XX:NewRatio=3 -XX:TargetSurvivorRatio=80 -Dsun.net.inetaddr.ttl=30 -DSTART=&quot;${launcher:sys.launcherDirectory}jetty/etc/start.config&quot; -Dzimbra.config=&quot;${launcher:sys.launcherDirectory}conf/localconfig.xml&quot; -Djava.library.path=&quot;${launcher:sys.launcherDirectory}lib&quot; -Djetty.home=&quot;${launcher:sys.launcherDirectory}jetty&quot; -Djava.awt.headless=true" arguments="org.mortbay.start.Main" allowVMPassthroughParameters="false" preferredVM="">
        <classPath>
          <archive location="lib/zdesktop.jar" failOnError="false" />
          <archive location="jetty/start.jar" failOnError="false" />
        </classPath>
        <nativeLibraryDirectories />
      </java>
      <includedFiles />
      <unextractableFiles />
      <customScript mode="1" file="">
        <scriptLines />
      </customScript>
    </launcher>
  </launchers>
  <installerGui installerType="1" suggestPreviousProgramGroup="true" addOnAppId="" suggestPreviousLocations="true">
    <customCode useInstalledFiles="false">
      <archive location="./build/dist/lib/derbytools.jar" />
      <archive location="./build/dist/jetty/lib/log4j-1.2.8.jar" />
      <archive location="./build/dist/jetty/common/lib/derby.jar" />
      <archive location="./build/dist/jetty/common/lib/dom4j-1.5.2.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-cli-1.2.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-codec-1.3.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-httpclient-3.0.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-logging.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-dbcp-1.1.jar" />
      <archive location="./build/dist/jetty/common/lib/commons-pool-1.1.jar" />
      <archive location="./build/dist/jetty/common/lib/json.jar" />
      <archive location="./build/dist/jetty/common/lib/mail.jar" />
      <archive location="./build/dist/jetty/common/lib/zimbracommon.jar" />
      <archive location="./build/dist/jetty/webapps/service/WEB-INF/lib/zimbrastore.jar" />
      <archive location="./build/dist/jetty/webapps/service/WEB-INF/lib/zimbraoffline.jar" />
    </customCode>
    <applications>
      <application name="" id="installer" beanClass="com.install4j.runtime.beans.applications.InstallerApplication" enabled="true" commentSet="false" comment="" customIcnsFile="./src/installer/resources/launcher_128x128.icns" customIcoFile="">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.applications.InstallerApplication">
              <void property="customHeaderImage">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./src/installer/resources/installer_60x60.png</string>
                </object>
              </void>
              <void property="customPngIcon16File">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./src/installer/resources/launcher_16x16.png</string>
                </object>
              </void>
              <void property="customPngIcon32File">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./src/installer/resources/launcher_32x32.png</string>
                </object>
              </void>
              <void property="useCustomIcon">
                <boolean>true</boolean>
              </void>
              <void property="vmParameters">
                <string>-Dinstall4j.noSecondaryProcess=true</string>
              </void>
            </object>
          </java>
        </serializedBean>
        <startup>
          <screen name="" id="15" beanClass="com.install4j.runtime.beans.screens.StartupScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.StartupScreen" />
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="init" id="284701" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>org.apache.log4j.BasicConfigurator.configure();

String ou = context.getCompilerVariable("offline_update");
if (ou != null &amp;&amp; ou.equals("true"))
    System.setProperty("offline_update", "true");
    
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="mac intel check" id="284702" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="${i18n:installer.ErrNoneIntelMac}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>String arch = System.getProperty("os.arch");
return arch.startsWith("i386") || arch.startsWith("x86");</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="Load installation info" id="286628" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import java.util.UUID;
import java.util.Properties;
import java.io.File;
import java.io.FileInputStream;

String instDir = (String) context.getVariable("sys.installationDir");
File regFile = new File(instDir + "/conf/install.info");
String guid;
String dev = "false";

if (regFile.exists()) {
    try {
        FileInputStream is = new FileInputStream(regFile);
        Properties prop = new Properties();
        prop.load(is);
        is.close();
        
        guid = prop.getProperty("guid", UUID.randomUUID().toString());
        
        String version = prop.getProperty("version");
        String build = prop.getProperty("build");
        if (version != null &amp;&amp; build != null &amp;&amp; version.length() &gt; 0 &amp;&amp; build.length() &gt; 0) {
            context.setVariable("prevVersion", version);
            context.setVariable("prevBuild", build);   
        }
        
        dev = prop.getProperty("dev", "false");
    } catch (IOException e) {
        guid = UUID.randomUUID().toString();
    }    
} else {
    guid = UUID.randomUUID().toString();
}

context.setVariable("instanceId", guid);
context.setVariable("joinDevProg", dev);
context.setVariable("autoCheckUpdates", true);

return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="needToUninstall" id="275892" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.w3c.dom.NodeList;
import org.w3c.dom.Node;
import org.w3c.dom.NamedNodeMap;
import org.w3c.dom.Element;

String appId = context.getApplicationId();
String servicePort = "7633";

ApplicationRegistry.ApplicationInfo[] appInfoList = ApplicationRegistry.getApplicationInfoById(appId);
boolean installed = (appInfoList != null &amp;&amp; appInfoList.length &gt; 0);

String pver = (String) context.getVariable("prevVersion");
boolean noPrevVer = (pver == null || pver.length() == 0);

if (installed) {
    File instDir = appInfoList[0].getInstallationDirectory();
    File confFile = new File(instDir.getAbsolutePath() + "/conf/localconfig.xml");
    String ver = "0.0";
    String build = "0";
    
    try {
        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
        DocumentBuilder db = dbf.newDocumentBuilder();
        Document doc = db.parse(confFile);
        
        NodeList nodeList = doc.getElementsByTagName("key");
        int len = nodeList.getLength();
        for (int i = 0; i &lt; len; i++) {
            NamedNodeMap nm = nodeList.item(i).getAttributes();           
            Node name = nm.getNamedItem("name");
            if (name == null)
                continue;
            
            if (noPrevVer &amp;&amp; name.getNodeValue().equals("zdesktop_version")) {
                ver = ((Element)nodeList.item(i)).getElementsByTagName("value").item(0)
                    .getChildNodes().item(0).getNodeValue();
            } else if (noPrevVer &amp;&amp; name.getNodeValue().equals("zdesktop_buildid")) {
                build = ((Element)nodeList.item(i)).getElementsByTagName("value").item(0)
                    .getChildNodes().item(0).getNodeValue();
            } else if (name.getNodeValue().equals("zimbra_admin_service_port")) {
                servicePort = ((Element)nodeList.item(i)).getElementsByTagName("value").item(0)
                    .getChildNodes().item(0).getNodeValue();
            }
        }
        context.setVariable("prevVersion", ver);
        context.setVariable("prevBuild", build);
    } catch(Exception e) {
        Util.showMessage(e.getMessage()); 
    }               
}

context.setVariable("servicePort", servicePort);

return installed;</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>needToUninstall</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="keepUserData" id="275893" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>File install = context.getDestinationFile(".");
File[] dirs = install.listFiles();
for (int i = 0; i &lt; dirs.length; ++i) {
    if (dirs[i].isDirectory() &amp;&amp; dirs[i].getName().equals("derby")) {
        return Boolean.TRUE;
    }
}
return Boolean.FALSE;</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>keepUserData</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("needToUninstall")</condition>
              </action>
              <action name="set userHome" id="286395" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>return Util.getUserHome();</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>userHome</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="" id="287296" beanClass="com.install4j.runtime.beans.actions.misc.RequireAdminAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="${i18n:installer.ErrNotAdmin}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RequireAdminAction" />
                  </java>
                </serializedBean>
                <condition>String nopass = System.getProperty("offline_nopass");
if (nopass != null &amp;&amp; nopass.equals("true"))
    return false;

return Boolean.getBoolean("offline_update") &amp;&amp; (Util.isMacOS() || Util.isWindows());</condition>
              </action>
              <action name="Disallow root user" id="287297" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="${i18n:installer.DisallowRoot}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>com.sun.security.auth.module.UnixSystem unix = new com.sun.security.auth.module.UnixSystem();
long uid = unix.getUid();
long gid = unix.getGid();
return (uid != 0 &amp;&amp; gid != 0);</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!Util.isWindows()</condition>
              </action>
              <action name="Set Language ID" id="287299" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>String langId = context.getLanguageId().replace('_', '-');
context.setVariable("languageId", langId);
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Set MacUninstaller Var" id="287300" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>String fullname = (String)context.getCompilerVariable("sys.fullName");
String uninstMenuEnt = context.getMessage("UninstallerMenuEntry").replaceFirst("\\{0\\}", fullname);
context.setVariable("macUninstaller", uninstMenuEnt + ".app");
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
            </actions>
            <formComponents />
          </screen>
        </startup>
        <screens>
          <screen name="" id="1" beanClass="com.install4j.runtime.beans.screens.WelcomeScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.WelcomeScreen">
                  <void property="bannerBackground">
                    <object class="java.awt.Color">
                      <int>255</int>
                      <int>255</int>
                      <int>255</int>
                      <int>255</int>
                    </object>
                  </void>
                  <void property="bannerImageFile">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./src/installer/resources/installer_banner.png</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Boolean.getBoolean("offline_update")</condition>
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents />
          </screen>
          <screen name="" id="92171" beanClass="com.install4j.runtime.beans.screens.LicenseScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.LicenseScreen">
                  <void property="displayedText">
                    <string>${i18n:installer.License}</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Boolean.getBoolean("offline_update")</condition>
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="" id="287298" beanClass="com.install4j.runtime.beans.actions.misc.RequireAdminAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="${i18n:installer.ErrNotAdmin}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RequireAdminAction" />
                  </java>
                </serializedBean>
                <condition>String nopass = System.getProperty("offline_nopass");
if (nopass != null &amp;&amp; nopass.equals("true"))
    return false;

return Util.isMacOS() || Util.isWindows();</condition>
              </action>
            </actions>
            <formComponents />
          </screen>
          <screen name="uninstall" id="6165" beanClass="com.install4j.runtime.beans.screens.DefaultInfoScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="3" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.DefaultInfoScreen">
                  <void property="displayedText">
                    <string>${i18n:installer.UninstallDisplay}</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Boolean.getBoolean("offline_update") &amp;&amp; context.getBooleanVariable("needToUninstall")</condition>
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents />
          </screen>
          <screen name="Block downgrading" id="287799" beanClass="com.install4j.runtime.beans.screens.FormScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="3" finishScreen="true">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.FormScreen">
                  <void property="fillVertically">
                    <boolean>false</boolean>
                  </void>
                  <void property="scrollable">
                    <boolean>false</boolean>
                  </void>
                  <void property="subTitle">
                    <string>${i18n:installer.ErrDowngrade}</string>
                  </void>
                  <void property="title">
                    <string>${i18n:installer.Error}</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>if (Boolean.getBoolean("offline_update"))
    return false;
    
String pv = (String)context.getVariable("prevVersion");
String pb = (String)context.getVariable("prevBuild");
if (pv == null || pb == null)
    return false;
    
return pv.compareTo("${compiler:offline_version}") &gt; 0 || pb.compareTo("${compiler:offline_buildid}") &gt; 0;</condition>
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents>
              <formComponent name="previous" id="287809" beanClass="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent">
                      <void property="labelText">
                        <string>${i18n:installer.PreviousVer}</string>
                      </void>
                      <void property="valueLabelText">
                        <string>${installer:prevVersion} / ${installer:prevBuild}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
              <formComponent name="" id="287811" beanClass="com.install4j.runtime.beans.formcomponents.SpacerComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.SpacerComponent">
                      <void property="height">
                        <int>5</int>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
              <formComponent name="installing" id="287810" beanClass="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent">
                      <void property="labelText">
                        <string>${i18n:installer.NewVer}</string>
                      </void>
                      <void property="valueLabelText">
                        <string>${compiler:offline_version} / ${compiler:offline_buildid}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
            </formComponents>
          </screen>
          <screen name="uninstall" id="275891" beanClass="com.install4j.runtime.beans.screens.CustomizableProgressScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.CustomizableProgressScreen">
                  <void property="subTitle">
                    <string>${i18n:installer.WaitUninstall}</string>
                  </void>
                  <void property="title">
                    <string>${i18n:installer.Uninstalling}</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>context.getBooleanVariable("needToUninstall")</condition>
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="" id="275899" beanClass="com.install4j.runtime.beans.actions.control.SetMessageAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetMessageAction">
                      <void property="statusMessage">
                        <string>${i18n:installer.UninstallStatus}</string>
                      </void>
                      <void property="useStatus">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="non-win" id="275900" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                      <void property="progressChangeType">
                        <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_TIMER" />
                      </void>
                      <void property="timerPeriod">
                        <int>200</int>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!Util.isWindows()</condition>
              </action>
              <action name="win" id="286014" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                      <void property="progressChangeType">
                        <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_TIMER" />
                      </void>
                      <void property="timerPeriod">
                        <int>500</int>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isWindows()</condition>
              </action>
              <group name="stop prism" id="287038" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup" />
                  </java>
                </serializedBean>
                <beans>
                  <action name="win and linux stop prism" id="287039" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="1">
                              <void index="0">
                                <string>${installer:prismBinaryArgs}</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:prismBinary}</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>if (Util.isMacOS())
    return false;
    
String pbld = (String)context.getVariable("prevBuild");
if (pbld == null)
    return false;
    
try {
    int bld = Integer.parseInt(pbld);
    if (bld &lt; 1272)
        return false;
        
    String instDir = (String)context.getVariable("sys.installationDir");
    String oldBin;
    String newBin;
    if (Util.isWindows()) {
        oldBin = instDir + "\\win32\\prism\\prism.exe";
        newBin = instDir + "\\win32\\prism\\zdclient.exe";
    } else {
        oldBin = instDir + "/linux/prism/prism";
        newBin = instDir + "/linux/prism/zdclient";
    }
    
    if ((new File(oldBin)).exists())
        context.setVariable("prismBinary", oldBin);
    else if ((new File(newBin)).exists())
        context.setVariable("prismBinary", newBin);
    else
        return false;
    
    String[] args = new String []{"-override",  Util.isWindows() ? 
        (instDir + "\\zdesktop.webapp\\override.ini") : 
        (instDir + "/zdesktop.webapp/override.ini"), "-close"};
    context.setVariable("prismBinaryArgs", args);
    return true;
} catch (Exception e) {
    return false;
}
   </condition>
                  </action>
                  <action name="macos stop prism" id="287041" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="1">
                              <void index="0">
                                <string>${installer:sys.installationDir}/macos/quit_zdesktop.applescript</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>/usr/bin/osascript</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isMacOS()</condition>
                  </action>
                </beans>
              </group>
              <action name="stop old win32 service" id="285547" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="2">
                          <void index="0">
                            <string>stop</string>
                          </void>
                          <void index="1">
                            <string>"Zimbra Desktop Service"</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>${installer:sys.system32Dir}/net.exe</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isWindows()</condition>
              </action>
              <action name="stop old linux service" id="285548" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>stop</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>zdesktop</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS()</condition>
              </action>
              <action name="" id="284552" beanClass="com.install4j.runtime.beans.actions.services.StopServiceAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.services.StopServiceAction">
                      <void property="launcherId">
                        <string>32</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!Util.isMacOS()</condition>
              </action>
              <action name="stop macos service" id="284553" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>stop</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>zdesktop</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <group name="kill service" id="287042" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup" />
                  </java>
                </serializedBean>
                <beans>
                  <action name="win32 kill service" id="287043" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="2">
                              <void index="0">
                                <string>svckill.vbs</string>
                              </void>
                              <void index="1">
                                <string>//b</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:sys.system32Dir}/cscript.exe</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>win32</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isWindows()</condition>
                  </action>
                  <action name="macos kill service" id="287044" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="1">
                              <void index="0">
                                <string>${installer:sys.installationDir}/macos/svckill.msh</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>/bin/sh</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isMacOS()</condition>
                  </action>
                  <action name="linux kill service" id="287045" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/linux/svckill.sh</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS()</condition>
                  </action>
                </beans>
              </group>
              <action name="migration test run" id="284554" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>System.setProperty("zimbra.config", context.getDestinationFile("conf/localconfig.xml").getAbsolutePath());

String errorMsg = null;

try {
    Thread.sleep(2000);
    new com.zimbra.cs.db.DbOfflineMigration().testRun();
    return true;
} catch (com.zimbra.cs.db.DbExclusiveAccessException x) {
    Thread.sleep(5000);
    try {
        new com.zimbra.cs.db.DbOfflineMigration().testRun();
        return true;
    } catch (com.zimbra.cs.db.DbExclusiveAccessException e) {
        Util.showMessage(context.getMessage("installer.ErrPrevSvcRunning"), javax.swing.JOptionPane.WARNING_MESSAGE);
        return false;
    }
} catch (com.zimbra.cs.db.DbNotFoundException x) {
    errorMsg = context.getMessage("installer.ErrDatasetMissing");
} catch (com.zimbra.cs.db.DbDataCorruptedException x) {
    errorMsg = context.getMessage("installer.ErrDatasetCorrupted");
} catch (com.zimbra.cs.db.DbUnsupportedVersionException x) {
    errorMsg = context.getMessage("installer.ErrDatasetTooOld");
} catch (com.zimbra.cs.db.DbUpdateException x) {
    errorMsg = context.getMessage("installer.ErrDatasetIncompat");
} catch (Exception x) {
    errorMsg = context.getMessage("installer.ErrDatasetUnreusable");
}

int choice = Util.showOptionDialog(errorMsg, new String[] {context.getMessage("installer.Quit"), context.getMessage("installer.DelDatasetContinue")},
        javax.swing.JOptionPane.WARNING_MESSAGE);

switch (choice) {
case 1:
    context.setVariable("keepUserData", Boolean.FALSE);
    return true;
default:
    return false;
}</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("keepUserData")</condition>
              </action>
              <action name="launchctl remove" id="275894" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="2">
                          <void index="0">
                            <string>remove</string>
                          </void>
                          <void index="1">
                            <string>com.zimbra.zdesktop</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>/bin/launchctl</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <group name="delete update.mar" id="287481" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>!Boolean.getBoolean("offline_update")</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <action name="win32 delete update.mar" id="287482" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                          <void property="backupForRollback">
                            <boolean>false</boolean>
                          </void>
                          <void property="file">
                            <object class="java.io.File">
                              <string>win32/prism/updates/0/update.mar</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isWindows()</condition>
                  </action>
                  <action name="linux delete update.mar" id="287483" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                          <void property="backupForRollback">
                            <boolean>false</boolean>
                          </void>
                          <void property="file">
                            <object class="java.io.File">
                              <string>linux/prism/updates/0/update.mar</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS()</condition>
                  </action>
                  <action name="macos delete update.mar" id="287484" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                          <void property="backupForRollback">
                            <boolean>false</boolean>
                          </void>
                          <void property="file">
                            <object class="java.io.File">
                              <string>macos/prism/Prism.app/Contents/Resources/updates/0/update.mar</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isMacOS()</condition>
                  </action>
                </beans>
              </group>
              <group name="backup prism user settings" id="289124" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup" />
                  </java>
                </serializedBean>
                <beans>
                  <action name="backup prefs.js" id="289125" beanClass="com.install4j.runtime.beans.actions.files.MoveFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.MoveFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>prefs.js.bak</string>
                            </object>
                          </void>
                          <void property="mode">
                            <string>600</string>
                          </void>
                          <void property="overwriteMode">
                            <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                          </void>
                          <void property="sourceFile">
                            <object class="java.io.File">
                              <string>profile/prefs.js</string>
                            </object>
                          </void>
                          <void property="triggerReboot">
                            <boolean>false</boolean>
                          </void>
                          <void property="uninstallMode">
                            <object class="com.install4j.api.context.UninstallMode" field="NEVER" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="backup persdict.dat" id="289126" beanClass="com.install4j.runtime.beans.actions.files.MoveFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.MoveFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>persdict.dat.bak</string>
                            </object>
                          </void>
                          <void property="overwriteMode">
                            <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                          </void>
                          <void property="sourceFile">
                            <object class="java.io.File">
                              <string>profile/persdict.dat</string>
                            </object>
                          </void>
                          <void property="triggerReboot">
                            <boolean>false</boolean>
                          </void>
                          <void property="uninstallMode">
                            <object class="com.install4j.api.context.UninstallMode" field="NEVER" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>String instDir = (String)context.getVariable("sys.installationDir");
return (new File(instDir + "/profile/persdict.dat")).exists();</condition>
                  </action>
                  <action name="backup localstore.json" id="289127" beanClass="com.install4j.runtime.beans.actions.files.MoveFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.MoveFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>localstore.json.bak</string>
                            </object>
                          </void>
                          <void property="overwriteMode">
                            <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                          </void>
                          <void property="sourceFile">
                            <object class="java.io.File">
                              <string>zdesktop.webapp/localstore.json</string>
                            </object>
                          </void>
                          <void property="triggerReboot">
                            <boolean>false</boolean>
                          </void>
                          <void property="uninstallMode">
                            <object class="com.install4j.api.context.UninstallMode" field="NEVER" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>String instDir = (String)context.getVariable("sys.installationDir");
return (new File(instDir + "/zdesktop.webapp/localstore.json")).exists();</condition>
                  </action>
                </beans>
              </group>
              <action name="clear error" id="285704" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>context.setErrorOccured(false);
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="macos uninstall symlink for older version" id="285294" beanClass="com.install4j.runtime.beans.actions.files.CreateSymlinkAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.CreateSymlinkAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}/Zimbra Desktop Uninstaller.app/Contents/MacOS/JavaApplicationStub</string>
                        </object>
                      </void>
                      <void property="linkFile">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}/uninstall</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>if (Util.isMacOS()) {
    String installDir = context.getVariable("sys.installationDir").toString();
    java.io.File uninstFile = new java.io.File(installDir + "/uninstall");
    return !uninstFile.exists();
} else {
    return false;
}</condition>
              </action>
              <action name="macos uninstaller" id="275895" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>-q</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}/uninstall</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="win32 uninstaller" id="275896" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>-q</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}/uninstall.exe</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isWindows()</condition>
              </action>
              <action name="linux uninstaller" id="275897" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>-q</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}/uninstall</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS()</condition>
              </action>
              <action name="check uninstall" id="275898" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="${i18n:installer.ErrUninstallFailed}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>String appId = context.getApplicationId();

ApplicationRegistry.ApplicationInfo[] appInfoList = ApplicationRegistry.getApplicationInfoById(appId);
if (appInfoList != null &amp;&amp; appInfoList.length &gt; 0) {
    return false;
}

return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="migration" id="275901" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>System.setProperty("zimbra.config", context.getDestinationFile("conf/localconfig.xml").getAbsolutePath());

String errorMsg = null;

try {
    new com.zimbra.cs.db.DbOfflineMigration().run();
    return true;
} catch (com.zimbra.cs.db.DbExclusiveAccessException x) {
    Thread.sleep(5000);
    try {
        new com.zimbra.cs.db.DbOfflineMigration().testRun();
        return true;
    } catch (com.zimbra.cs.db.DbExclusiveAccessException e) {
        Util.showMessage(context.getMessage("installer.ErrPrevSvcRunning"), javax.swing.JOptionPane.WARNING_MESSAGE);
        return false;
    }
} catch (com.zimbra.cs.db.DbNotFoundException x) {
    errorMsg = context.getMessage("installer.ErrDatasetMissing");
} catch (com.zimbra.cs.db.DbDataCorruptedException x) {
    errorMsg = context.getMessage("installer.ErrDatasetCorrupted");
} catch (com.zimbra.cs.db.DbUnsupportedVersionException x) {
    errorMsg = context.getMessage("installer.ErrDatasetTooOld");
} catch (com.zimbra.cs.db.DbUpdateException x) {
    errorMsg = context.getMessage("installer.ErrDatasetIncompat");
} catch (Exception x) {
    errorMsg = context.getMessage("installer.ErrDatasetUnreusable");
}

int choice = Util.showOptionDialog(errorMsg, new String[] {context.getMessage("installer.Quit"), context.getMessage("installer.DelDatasetContinue")},
        javax.swing.JOptionPane.WARNING_MESSAGE);

switch (choice) {
case 1:
    context.setVariable("keepUserData", Boolean.FALSE);
    return true;
default:
    return false;
}</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("keepUserData")</condition>
              </action>
              <action name="derby" id="275903" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>derby</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.getBooleanVariable("keepUserData")</condition>
              </action>
              <action name="index" id="275904" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>index</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.getBooleanVariable("keepUserData")</condition>
              </action>
              <action name="store" id="275905" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>store</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.getBooleanVariable("keepUserData")</condition>
              </action>
              <action name="redolog" id="275906" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>redolog</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.getBooleanVariable("keepUserData")</condition>
              </action>
              <action name="log" id="275907" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>log</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.getBooleanVariable("keepUserData")</condition>
              </action>
              <action name="zdesktop.webapp" id="275911" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>zdesktop.webapp</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="profile" id="288940" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>profile</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="zimlets" id="275913" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>zimlets</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="db" id="275914" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>db</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="conf" id="275915" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="false" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>conf</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="lib" id="275916" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>lib</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="jetty/work" id="275917" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>jetty/work</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Uninstaller.app" id="284391" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>Zimbra Desktop Uninstaller.app</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="zdesktop" id="275918" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.getBooleanVariable("keepUserData")</condition>
              </action>
              <action name="delete old mac app dir" id="286264" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="backupForRollback">
                        <boolean>false</boolean>
                      </void>
                      <void property="file">
                        <object class="java.io.File">
                          <string>/Applications/Zimbra Desktop.app</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="delete mac app dir" id="286265" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="backupForRollback">
                        <boolean>false</boolean>
                      </void>
                      <void property="file">
                        <object class="java.io.File">
                          <string>/Applications/Yahoo! Zimbra Desktop.app</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="delete old mac desktop icon" id="286396" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="backupForRollback">
                        <boolean>false</boolean>
                      </void>
                      <void property="file">
                        <object class="java.io.File">
                          <string>${installer:userHome}/Desktop/Zimbra Desktop.app</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="delete mac desktop icon" id="286397" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="backupForRollback">
                        <boolean>false</boolean>
                      </void>
                      <void property="file">
                        <object class="java.io.File">
                          <string>${installer:userHome}/Desktop/Yahoo! Zimbra Desktop.app</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
            </actions>
            <formComponents />
          </screen>
          <screen name="" id="2" beanClass="com.install4j.runtime.beans.screens.InstallationDirectoryScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="3" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.InstallationDirectoryScreen">
                  <void property="allowSpacesOnUnix">
                    <boolean>true</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Boolean.getBoolean("offline_update") &amp;&amp; !context.getBooleanVariable("keepUserData")</condition>
            <validation>import java.util.regex.*;

String langId = context.getLanguageId();
if (langId.equalsIgnoreCase("zh_cn") ||
    langId.equalsIgnoreCase("zh_hk") ||
    langId.equalsIgnoreCase("ja") ||
    langId.equalsIgnoreCase("ko"))
    return true;

String instPath = context.getInstallationDirectory().getPath();
Pattern p = Pattern.compile("[!`']");
Matcher m = p.matcher(instPath);
if (m.find()) {
    Util.showErrorMessage(context.getMessage("installer.ErrBadCharsInPath"));
    return false;
}
return true;</validation>
            <preActivation>if (Util.isWindows()) {
    String subdir = Util.isWindowsVista() ? "\\AppData\\Local\\Zimbra\\zdesktop" : "\\Local Settings\\Application Data\\Zimbra\\zdesktop";
    context.setInstallationDirectory(new File(context.getVariable("sys.userHome") + subdir));
}</preActivation>
            <postActivation />
            <actions />
            <formComponents />
          </screen>
          <screen name="" id="5" beanClass="com.install4j.runtime.beans.screens.InstallationScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="true" backButton="2" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.InstallationScreen" />
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="clear error" id="275927" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>context.setErrorOccured(false);
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="" id="6" beanClass="com.install4j.runtime.beans.actions.InstallFilesAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.InstallFilesAction">
                      <void property="fileFilterScript">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string />
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="README" id="92226" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                      <void property="suffixes">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>.txt</string>
                          </void>
                        </array>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="conf/localconfig.xml" id="92224" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>conf/localconfig.xml</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="conf/log4j.properties" id="287999" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>conf/log4j.properties</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="conf/datasource.xml" id="288000" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>conf/datasource.xml</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="jetty" id="92395" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>jetty</string>
                        </object>
                      </void>
                      <void property="suffixes">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>.txt</string>
                          </void>
                        </array>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="jetty/LICENSES" id="92393" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>jetty/LICENSES</string>
                        </object>
                      </void>
                      <void property="recursive">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="jetty/etc" id="92392" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>jetty/etc</string>
                        </object>
                      </void>
                      <void property="recursive">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="jetty/resources" id="92394" beanClass="com.install4j.runtime.beans.actions.text.FixCrLfAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.FixCrLfAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>jetty/resources</string>
                        </object>
                      </void>
                      <void property="recursive">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="set installationDirUtf8" id="288442" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import java.nio.charset.CharsetDecoder;
import java.nio.charset.Charset;
import java.nio.charset.CharacterCodingException;
import java.nio.ByteBuffer;

boolean utf8 = true;
String instDir = (String)context.getVariable("sys.installationDir");
CharsetDecoder cd = Charset.availableCharsets().get("UTF-8").newDecoder();
try {
    cd.decode(ByteBuffer.wrap(instDir.getBytes()));
} catch (CharacterCodingException e) {
    utf8 = false;
}
return utf8 ? instDir : new String(instDir.getBytes("UTF-8"));
</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>installationDirUtf8</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="localconfig.xml" id="850" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>conf/localconfig.xml</string>
                        </object>
                      </void>
                      <void property="replaceValue">
                        <string>${installer:installationDirUtf8}</string>
                      </void>
                      <void property="searchValue">
                        <string>@install@</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="start.config" id="1143" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>jetty/etc/start.config</string>
                        </object>
                      </void>
                      <void property="replaceValue">
                        <string>${installer:sys.installationDir}</string>
                      </void>
                      <void property="searchValue">
                        <string>/opt/zimbra/zdesktop</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="derbyij.sql" id="263088" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>db/derbyij.sql</string>
                        </object>
                      </void>
                      <void property="replaceValue">
                        <string>${installer:sys.installationDir}</string>
                      </void>
                      <void property="searchValue">
                        <string>@install@</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="derbyij" id="263089" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:installer.ErrDBInitFailed}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>System.setProperty("zimbra.config", context.getDestinationFile("conf/localconfig.xml").getAbsolutePath());

try {
    File f = context.getDestinationFile("db" + File.separator + "derbyij.sql");
    org.apache.derby.tools.ij.main(new String[] {f.getAbsolutePath()});
    return true;
} catch (Exception x) {
    context.setErrorOccured(true);
    return false;
}</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.getBooleanVariable("keepUserData")</condition>
              </action>
              <action name="" id="8" beanClass="com.install4j.runtime.beans.actions.desktop.RegisterAddRemoveAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.desktop.RegisterAddRemoveAction">
                      <void property="icon">
                        <object class="com.install4j.api.beans.ExternalFile">
                          <string>./src/installer/resources/launcher_16x16.ico</string>
                        </object>
                      </void>
                      <void property="itemName">
                        <string>${compiler:sys.fullName} ${compiler:sys.version}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.isErrorOccured()</condition>
              </action>
            </actions>
            <formComponents />
          </screen>
          <screen name="" id="5391" beanClass="com.install4j.runtime.beans.screens.AdditionalConfirmationsScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="3" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.AdditionalConfirmationsScreen" />
              </java>
            </serializedBean>
            <condition>!Boolean.getBoolean("offline_update") &amp;&amp; !context.isErrorOccured()</condition>
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents>
              <formComponent name="" id="289902" beanClass="com.install4j.runtime.beans.formcomponents.SpacerComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.SpacerComponent">
                      <void property="height">
                        <int>7</int>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
              <formComponent name="Set service port" id="289590" beanClass="com.install4j.runtime.beans.formcomponents.TextfieldComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.TextfieldComponent">
                      <void property="initialText">
                        <string>${installer:servicePort}</string>
                      </void>
                      <void property="inputVerifier">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>boolean valid = true;
try {
    int port = Integer.parseInt(text);
    if (port &lt;= 1024 || port &gt;= 65536)
        valid = false;
} catch (Exception e) {
    valid = false;
}

if (!valid) {
    Util.showMessage(context.getMessage("installer.ServicePortWarn"), javax.swing.JOptionPane.WARNING_MESSAGE);
    return false;
}

return true;</string>
                          </void>
                        </object>
                      </void>
                      <void property="labelText">
                        <string>${i18n:installer.ServicePort}</string>
                      </void>
                      <void property="variableName">
                        <string>servicePort</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
              <formComponent name="Service port note" id="289746" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                      <void property="labelText">
                        <string>${i18n:installer.ServicePortNote}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
              <formComponent name="" id="289747" beanClass="com.install4j.runtime.beans.formcomponents.SpacerComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.SpacerComponent">
                      <void property="height">
                        <int>7</int>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
              <formComponent name="Add a desktop link" id="5392" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                      <void property="checkboxText">
                        <string>${i18n:CreateDesktopIcon}</string>
                      </void>
                      <void property="initiallySelected">
                        <boolean>true</boolean>
                      </void>
                      <void property="variableName">
                        <string>createDesktopLinkAction</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript>if (!Util.isWindows() &amp;&amp; !Util.isMacOS()) {
    configurationObject.setSelected(true);
    configurationObject.setEnabled(false);
}
</initScript>
              </formComponent>
            </formComponents>
          </screen>
          <screen name="launch" id="4229" beanClass="com.install4j.runtime.beans.screens.CustomizableProgressScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.CustomizableProgressScreen">
                  <void property="subTitle">
                    <string>${i18n:installer.WaitService}</string>
                  </void>
                  <void property="title">
                    <string>${i18n:installer.StartingService}</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.isErrorOccured()</condition>
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="Set createDesktopLinkAction" id="287336" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>return Boolean.TRUE;</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>createDesktopLinkAction</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Boolean.getBoolean("offline_update")</condition>
              </action>
              <group name="Set service port" id="289591" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup" />
                  </java>
                </serializedBean>
                <beans>
                  <action name="jetty.xml" id="289592" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>jetty/etc/jetty.xml</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>"jetty.port" default="${installer:servicePort}"</string>
                          </void>
                          <void property="searchValue">
                            <string>"jetty.port" default="7633"</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="service web.xml" id="289593" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>jetty/webapps/service/WEB-INF/web.xml</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>servicePort "${installer:servicePort}"</string>
                          </void>
                          <void property="searchValue">
                            <string>servicePort "7633"</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="zimbra web.xml" id="289594" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>jetty/webapps/zimbra/WEB-INF/web.xml</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>servicePort "${installer:servicePort}"</string>
                          </void>
                          <void property="searchValue">
                            <string>servicePort "7633"</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="localconfig.xml" id="289596" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>conf/localconfig.xml</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>servicePort "${installer:servicePort}"</string>
                          </void>
                          <void property="searchValue">
                            <string>servicePort "7633"</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="webapp.ini" id="289595" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>zdesktop.webapp/webapp.ini</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>127.0.0.1:${installer:servicePort}</string>
                          </void>
                          <void property="searchValue">
                            <string>127.0.0.1:7633</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </beans>
              </group>
              <group name="win32" id="288585" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>Util.isWindows()</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <action name="win32 links" id="288586" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>import com.install4j.api.windows.WinRegistry;
import com.install4j.api.windows.RegistryRoot;

File prism = context.getDestinationFile("win32/prism/zdclient.exe");

String iconFile = Util.isWindowsVista() ? "win32/launcher_48x48.ico" : "win32/launcher_32x32.ico";
File icon = context.getDestinationFile(iconFile);

File desktop = new File(WinFileSystem.getSpecialFolder(SpecialFolder.DESKTOP, false), "Yahoo! Zimbra Desktop.lnk");
File startmenu = new File(WinFileSystem.getSpecialFolder(SpecialFolder.STARTMENU, false), "Yahoo! Zimbra Desktop.lnk");

WinFileSystem.createShellLink(startmenu, prism, icon, "", "Yahoo! Zimbra Desktop");
if (context.getBooleanVariable("createDesktopLinkAction"))
  WinFileSystem.createShellLink(desktop, prism, icon, "", "Yahoo! Zimbra Desktop");

// migrate old mailto registery entry that still refers to prism.exe
String mailtoCmd = (String)WinRegistry.getValue(RegistryRoot.HKEY_CLASSES_ROOT, "mailto\\shell\\open\\command", "");
int pos;
if (mailtoCmd != null &amp;&amp; (pos = mailtoCmd.indexOf("prism.exe")) &gt;= 0) {
    String newCmd = mailtoCmd.substring(0, pos) + "zdclient.exe";
    if (newCmd.substring(0, 1).equals("\""))
        newCmd = newCmd + "\"";
    newCmd = newCmd + " -url \"%1\"";
    WinRegistry.setValue(RegistryRoot.HKEY_CLASSES_ROOT, "mailto\\shell\\open\\command", "", newCmd);
}

return true;</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="application.ini" id="288587" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>win32/prism/application.ini</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>${installer:sys.installationDir}</string>
                          </void>
                          <void property="searchValue">
                            <string>@install@</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </beans>
              </group>
              <group name="macos" id="287305" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>Util.isMacOS()</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <group name="macos.app" id="287306" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.groups.ActionGroup">
                          <void property="conditionExpression">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>Util.isMacOS()</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <beans>
                      <action name="application.ini" id="287307" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                              <void property="file">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/application.ini</string>
                                </object>
                              </void>
                              <void property="replaceValue">
                                <string>${installer:sys.installationDir}</string>
                              </void>
                              <void property="searchValue">
                                <string>@install@</string>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS()</condition>
                      </action>
                      <action name="macos.app prism" id="287309" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                              <void property="file">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/MacOS/prism</string>
                                </object>
                              </void>
                              <void property="mode">
                                <string>755</string>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS()</condition>
                      </action>
                    </beans>
                  </group>
                  <group name="macos desktop" id="287310" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.groups.ActionGroup">
                          <void property="conditionExpression">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>Util.isMacOS()</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <beans>
                      <action name="desktop/Info.plist" id="287311" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>${installer:sys.userHome}/Desktop/Yahoo! Zimbra Desktop.app/Contents/Info.plist</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Info.plist</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
                      </action>
                      <action name="desktop/icns" id="287312" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>${installer:sys.userHome}/Desktop/Yahoo! Zimbra Desktop.app/Contents/Resources/launcher_128x128.icns</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/launcher_128x128.icns</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
                      </action>
                      <action name="desktop/prism" id="287313" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>${installer:sys.userHome}/Desktop/Yahoo! Zimbra Desktop.app/Contents/MacOS/prism</string>
                                </object>
                              </void>
                              <void property="mode">
                                <string>755</string>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/MacOS/prism</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
                      </action>
                      <action name="desktop/application.ini" id="287314" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>${installer:sys.userHome}/Desktop/Yahoo! Zimbra Desktop.app/Contents/Resources/application.ini</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/application.ini</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
                      </action>
                      <action name="desktop/brand.dtd" id="287315" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>${installer:sys.userHome}/Desktop/Yahoo! Zimbra Desktop.app/Contents/Resources/branding/brand.dtd</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/branding/brand.dtd</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
                      </action>
                      <action name="desktop/brand.properties" id="287316" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>${installer:sys.userHome}/Desktop/Yahoo! Zimbra Desktop.app/Contents/Resources/branding/brand.properties</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/branding/brand.properties</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
                      </action>
                      <action name="desktop/chrome.manifest" id="287317" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>${installer:sys.userHome}/Desktop/Yahoo! Zimbra Desktop.app/Contents/Resources/chrome/chrome.manifest</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/chrome/chrome.manifest</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
                      </action>
                      <action name="desktop" id="287319" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                              <void property="file">
                                <object class="java.io.File">
                                  <string>${installer:sys.userHome}/Desktop/Yahoo! Zimbra Desktop.app</string>
                                </object>
                              </void>
                              <void property="mode">
                                <string>775</string>
                              </void>
                              <void property="recursive">
                                <boolean>true</boolean>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
                      </action>
                    </beans>
                  </group>
                  <group name="Application" id="287320" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.groups.ActionGroup">
                          <void property="conditionExpression">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>Util.isMacOS()</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <beans>
                      <action name="applications/Info.plist" id="287321" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>/Applications/Yahoo! Zimbra Desktop.app/Contents/Info.plist</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Info.plist</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS()</condition>
                      </action>
                      <action name="applications/icns" id="287322" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>/Applications/Yahoo! Zimbra Desktop.app/Contents/Resources/launcher_128x128.icns</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/launcher_128x128.icns</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS()</condition>
                      </action>
                      <action name="applications/prism" id="287323" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>/Applications/Yahoo! Zimbra Desktop.app/Contents/MacOS/prism</string>
                                </object>
                              </void>
                              <void property="mode">
                                <string>755</string>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/MacOS/prism</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS()</condition>
                      </action>
                      <action name="applications/application.ini" id="287324" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>/Applications/Yahoo! Zimbra Desktop.app/Contents/Resources/application.ini</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/application.ini</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS()</condition>
                      </action>
                      <action name="applications/brand.dtd" id="287325" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>/Applications/Yahoo! Zimbra Desktop.app/Contents/Resources/branding/brand.dtd</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/branding/brand.dtd</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS()</condition>
                      </action>
                      <action name="applications/brand.properties" id="287326" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>/Applications/Yahoo! Zimbra Desktop.app/Contents/Resources/branding/brand.properties</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/branding/brand.properties</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS()</condition>
                      </action>
                      <action name="applications/chrome.manifest" id="287327" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                              <void property="destinationFile">
                                <object class="java.io.File">
                                  <string>/Applications/Yahoo! Zimbra Desktop.app/Contents/Resources/chrome/chrome.manifest</string>
                                </object>
                              </void>
                              <void property="overwriteMode">
                                <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                              </void>
                              <void property="sourceFile">
                                <object class="java.io.File">
                                  <string>macos/Yahoo! Zimbra Desktop.app/Contents/Resources/chrome/chrome.manifest</string>
                                </object>
                              </void>
                              <void property="uninstallMode">
                                <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS()</condition>
                      </action>
                      <action name="applications" id="287329" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                              <void property="file">
                                <object class="java.io.File">
                                  <string>/Applications/Yahoo! Zimbra Desktop.app</string>
                                </object>
                              </void>
                              <void property="mode">
                                <string>775</string>
                              </void>
                              <void property="recursive">
                                <boolean>true</boolean>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>Util.isMacOS()</condition>
                      </action>
                    </beans>
                  </group>
                </beans>
              </group>
              <group name="linux desktop" id="287330" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup" />
                  </java>
                </serializedBean>
                <beans>
                  <action name="webapp.ini" id="287331" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>zdesktop.webapp/webapp.ini</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>status=true</string>
                          </void>
                          <void property="searchValue">
                            <string>status=false</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS()</condition>
                  </action>
                  <action name="linux.desktop" id="287332" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>linux/linux.desktop</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>${installer:sys.installationDir}</string>
                          </void>
                          <void property="searchValue">
                            <string>@install@</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS()</condition>
                  </action>
                  <action name="linux.desktop" id="287333" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>${installer:sys.userHome}/Desktop/linux.desktop</string>
                            </object>
                          </void>
                          <void property="overwriteMode">
                            <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                          </void>
                          <void property="sourceFile">
                            <object class="java.io.File">
                              <string>linux/linux.desktop</string>
                            </object>
                          </void>
                          <void property="uninstallMode">
                            <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS() &amp;&amp; context.getBooleanVariable("createDesktopLinkAction")</condition>
                  </action>
                </beans>
              </group>
              <action name="clear error" id="287334" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>context.setErrorOccured(false);
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="zdesktop" id="145686" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>zdesktop</string>
                        </object>
                      </void>
                      <void property="searchValue">
                        <string>nohup</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="zdesktop" id="145687" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>zdesktop</string>
                        </object>
                      </void>
                      <void property="replaceValue">
                        <string>org.mortbay.start.Main</string>
                      </void>
                      <void property="searchValue">
                        <string>org.mortbay.start.Main &amp;</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="zdesktop" id="68534" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>zdesktop</string>
                        </object>
                      </void>
                      <void property="mode">
                        <string>755</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="set install key in localconfig.xml" id="288134" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="encoding">
                        <string />
                      </void>
                      <void property="file">
                        <object class="java.io.File">
                          <string>conf/localconfig.xml</string>
                        </object>
                      </void>
                      <void property="replaceValue">
                        <string>${installer:instanceId}</string>
                      </void>
                      <void property="searchValue">
                        <string>@install_key@</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="launchd.plist" id="5292" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>macos/launchd.plist</string>
                        </object>
                      </void>
                      <void property="replaceValue">
                        <string>${installer:sys.installationDir}</string>
                      </void>
                      <void property="searchValue">
                        <string>@install@</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="launchd.plist" id="6149" beanClass="com.install4j.runtime.beans.actions.files.MoveFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.MoveFileAction">
                      <void property="destinationFile">
                        <object class="java.io.File">
                          <string>${installer:sys.userHome}/Library/LaunchAgents/com.zimbra.zdesktop.plist</string>
                        </object>
                      </void>
                      <void property="overwriteMode">
                        <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                      </void>
                      <void property="sourceFile">
                        <object class="java.io.File">
                          <string>macos/launchd.plist</string>
                        </object>
                      </void>
                      <void property="uninstallMode">
                        <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
              </action>
              <action name="set access mode for LaunchAgents" id="289389" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>${installer:sys.userHome}/Library/LaunchAgents</string>
                        </object>
                      </void>
                      <void property="mode">
                        <string>755</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
              </action>
              <action name="launchctl" id="145688" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="2">
                          <void index="0">
                            <string>load</string>
                          </void>
                          <void index="1">
                            <string>${installer:sys.userHome}/Library/LaunchAgents/com.zimbra.zdesktop.plist</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>/bin/launchctl</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
              </action>
              <action name="launchctl" id="5294" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="2">
                          <void index="0">
                            <string>start</string>
                          </void>
                          <void index="1">
                            <string>com.zimbra.zdesktop</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>/bin/launchctl</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>log</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
              </action>
              <action name="" id="263046" beanClass="com.install4j.runtime.beans.actions.services.InstallServiceAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:installer.ErrCoreSvcFailed}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.services.InstallServiceAction">
                      <void property="allowUserChangeStartType">
                        <boolean>false</boolean>
                      </void>
                      <void property="launcherId">
                        <string>32</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
              </action>
              <action name="quote path to exe on windows" id="289390" beanClass="com.install4j.runtime.beans.actions.registry.SetRegistryValueAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.registry.SetRegistryValueAction">
                      <void property="createKey">
                        <boolean>false</boolean>
                      </void>
                      <void property="keyName">
                        <string>SYSTEM\CurrentControlSet\Services\Yahoo! Zimbra Desktop Service</string>
                      </void>
                      <void property="registryRoot">
                        <object class="com.install4j.api.windows.RegistryRoot" field="HKEY_LOCAL_MACHINE" />
                      </void>
                      <void property="value">
                        <string>"${installer:sys.installationDir}\zdesktop.exe"</string>
                      </void>
                      <void property="valueName">
                        <string>ImagePath</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>if (!Util.isWindows())
    return false;    
String instDir = (String)context.getVariable("sys.installationDir");
return instDir.indexOf(" ") &gt;= 0;
</condition>
              </action>
              <action name="" id="263047" beanClass="com.install4j.runtime.beans.actions.services.StartServiceAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:installer.ErrCoreSvcNotStarted}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.services.StartServiceAction">
                      <void property="launcherId">
                        <string>32</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!Util.isMacOS() &amp;&amp; !context.isErrorOccured()</condition>
              </action>
              <action name="" id="4230" beanClass="com.install4j.runtime.beans.actions.control.SetMessageAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetMessageAction">
                      <void property="statusMessage">
                        <string>${i18n:installer.StartingService}</string>
                      </void>
                      <void property="useStatus">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.isErrorOccured()</condition>
              </action>
              <action name="" id="4231" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                      <void property="progressChangeType">
                        <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_TIMER" />
                      </void>
                      <void property="timerPeriod">
                        <int>100</int>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.isErrorOccured()</condition>
              </action>
              <action name="zimlets" id="4232" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:installer.ErrInjectZimletFailed}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>System.setProperty("zimbra.config", context.getDestinationFile("conf/localconfig.xml").getAbsolutePath());

org.apache.log4j.Logger.getRootLogger().setLevel(org.apache.log4j.Level.OFF);

String port = (String)context.getVariable("servicePort");
org.apache.commons.httpclient.HttpClient client = new org.apache.commons.httpclient.HttpClient();
String url = "http://127.0.0.1:" + port + "/service/admin/soap";
org.apache.commons.httpclient.methods.GetMethod get = new org.apache.commons.httpclient.methods.GetMethod(url);

boolean isServiceUp = false;
for (int i = 0; i &lt; 3; ++i) {
	Thread.sleep(5000);
    try {
        client.executeMethod(get);
        int status = get.getStatusCode();
        if (status == 405) { //when service not up we get 404; 405 means GET not supported but service is up
            isServiceUp = true;
            break;
        }
    } catch (Throwable t) {
    } finally {
        get.releaseConnection();
    }
}

if (!isServiceUp) return false;

File zimletsDir = context.getDestinationFile("zimlets");

FilenameFilter fnf = new FilenameFilter() {
    public boolean accept(File dir, String name) {
        return name.endsWith(".zip");
    } 
};

File[] zimlets = zimletsDir.listFiles(fnf);
boolean hasFailures = false;
for (int i = 0; i &lt; zimlets.length; ++i) {
    try {
        com.zimbra.cs.zimlet.ZimletUtil.deployZimletBySoap(zimlets[i].getAbsolutePath(),
            "http://127.0.0.1:" + port + "/service/admin/soap/", 
            "http://127.0.0.1:" + port + "/service/upload?fmt=raw",
            "zimbra", (String)context.getVariable("instanceId"));
        zimlets[i].delete();
    } catch (Exception x) {
        hasFailures = true;
    }
}

return !hasFailures;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!context.isErrorOccured()</condition>
              </action>
              <action name="Create macos uninstall link" id="285070" beanClass="com.install4j.runtime.beans.actions.files.CreateSymlinkAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.CreateSymlinkAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}/${installer:macUninstaller}/Contents/MacOS/JavaApplicationStub</string>
                        </object>
                      </void>
                      <void property="linkFile">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}/uninstall</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="Create user.js" id="285015" beanClass="com.install4j.runtime.beans.actions.text.AppendToFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.AppendToFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>profile/user.js</string>
                        </object>
                      </void>
                      <void property="text">
                        <string>
user_pref("general.useragent.locale", "@languageId@");
user_pref("intl.accept_languages", "@languageId@");
user_pref("spellchecker.dictionary", "@languageId@");
user_pref("browser.cache.disk.capacity", "6144");
user_pref("browser.cache.memory.capacity", "6144");
user_pref("browser.sessionhistory.max_total_viewers", "2");
user_pref("config.trim_on_minimize", "true");
user_pref("network.http.pipelining", "true");
user_pref("nglayout.initialpaint.delay", "150");
                        </string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Modify user.js" id="285016" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="escapeForPropertyFile">
                        <boolean>true</boolean>
                      </void>
                      <void property="file">
                        <object class="java.io.File">
                          <string>profile/user.js</string>
                        </object>
                      </void>
                      <void property="replaceValue">
                        <string>${installer:languageId}</string>
                      </void>
                      <void property="searchValue">
                        <string>@languageId@</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Save installation info" id="286567" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import java.io.File;
import java.io.FileWriter;

String instDir = (String) context.getVariable("sys.installationDir");
File regFile = new File(instDir + "/conf/install.info");

String upPath = Util.isWindows() ? "/win32/prism/" :
    (Util.isMacOS() ? "/macos/prism/Prism.app/Contents/Resources/" : "/linux/prism/");
File upFile = new File(instDir + upPath + "update.params");

try {
   //install.info
    if (!regFile.exists())
        regFile.createNewFile();

    FileWriter writer = new FileWriter(regFile);
    writer.write("### THIS FILE IS CREATED BY THE INSTALLER OF YAHOO! ZIMBRA DESKTOP. PLEASE DO NOT EDIT. ###\n");

    writer.write("version=${compiler:offline_version}\n");
    writer.write("build=${compiler:offline_buildid}\n");
    writer.write("locale=" + (String) context.getLanguageId() + "\n");
    writer.write("guid=" + (String) context.getVariable("instanceId") + "\n");
    writer.close();
    
    //update.params
    if (!upFile.exists())
        upFile.createNewFile();
     
    writer = new FileWriter(upFile);
    writer.write("-Doffline_update=true\n");
    writer.write("-Dinstall4j.language=" + (String) context.getLanguageId() + "\n");   
    writer.close();            
} catch (IOException e) {
    Util.showWarningMessage(e.getMessage());
}

return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <group name="macos copy update.params" id="288279" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>Util.isMacOS()</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <action name="copy to desktop" id="288280" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>${installer:sys.userHome}/Desktop/Yahoo! Zimbra Desktop.app/Contents/Resources/update.params</string>
                            </object>
                          </void>
                          <void property="overwriteMode">
                            <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                          </void>
                          <void property="sourceFile">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/macos/prism/Prism.app/Contents/Resources/update.params</string>
                            </object>
                          </void>
                          <void property="uninstallMode">
                            <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>context.getBooleanVariable("createDesktopLinkAction")</condition>
                  </action>
                  <action name="copy to applications" id="288281" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>/Applications/Yahoo! Zimbra Desktop.app/Contents/Resources/update.params</string>
                            </object>
                          </void>
                          <void property="overwriteMode">
                            <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                          </void>
                          <void property="sourceFile">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/macos/prism/Prism.app/Contents/Resources/update.params</string>
                            </object>
                          </void>
                          <void property="uninstallMode">
                            <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="copy to macos" id="288282" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/macos/Yahoo! Zimbra Desktop.app/Contents/Resources/update.params</string>
                            </object>
                          </void>
                          <void property="overwriteMode">
                            <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                          </void>
                          <void property="sourceFile">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/macos/prism/Prism.app/Contents/Resources/update.params</string>
                            </object>
                          </void>
                          <void property="uninstallMode">
                            <object class="com.install4j.api.context.UninstallMode" field="ALWAYS" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </beans>
              </group>
              <action name="set install key in webapp.ini" id="288135" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>zdesktop.webapp/webapp.ini</string>
                        </object>
                      </void>
                      <void property="replaceValue">
                        <string>${installer:instanceId}</string>
                      </void>
                      <void property="searchValue">
                        <string>@install_key@</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <group name="set special file permissions" id="288362" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>!Util.isWindows()</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <action name="install.info" id="288363" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>conf/install.info</string>
                            </object>
                          </void>
                          <void property="mode">
                            <string>600</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="localconfig.xml" id="288364" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>conf/localconfig.xml</string>
                            </object>
                          </void>
                          <void property="mode">
                            <string>600</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="webapp.ini" id="288365" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>zdesktop.webapp/webapp.ini</string>
                            </object>
                          </void>
                          <void property="mode">
                            <string>600</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </beans>
              </group>
              <group name="restore prism user settings" id="288932" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup" />
                  </java>
                </serializedBean>
                <beans>
                  <action name="restore prefs.js" id="288933" beanClass="com.install4j.runtime.beans.actions.files.MoveFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.MoveFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>profile/prefs.js</string>
                            </object>
                          </void>
                          <void property="mode">
                            <string>600</string>
                          </void>
                          <void property="overwriteMode">
                            <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                          </void>
                          <void property="sourceFile">
                            <object class="java.io.File">
                              <string>prefs.js.bak</string>
                            </object>
                          </void>
                          <void property="triggerReboot">
                            <boolean>false</boolean>
                          </void>
                          <void property="uninstallMode">
                            <object class="com.install4j.api.context.UninstallMode" field="NEVER" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>String instDir = (String)context.getVariable("sys.installationDir");
return (new File(instDir + "/prefs.js.bak")).exists();</condition>
                  </action>
                  <action name="restore persdict.dat" id="288934" beanClass="com.install4j.runtime.beans.actions.files.MoveFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.MoveFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>profile/persdict.dat</string>
                            </object>
                          </void>
                          <void property="overwriteMode">
                            <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                          </void>
                          <void property="sourceFile">
                            <object class="java.io.File">
                              <string>persdict.dat.bak</string>
                            </object>
                          </void>
                          <void property="triggerReboot">
                            <boolean>false</boolean>
                          </void>
                          <void property="uninstallMode">
                            <object class="com.install4j.api.context.UninstallMode" field="NEVER" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>String instDir = (String)context.getVariable("sys.installationDir");
return (new File(instDir + "/persdict.dat.bak")).exists();</condition>
                  </action>
                  <action name="restore localstore.json" id="289128" beanClass="com.install4j.runtime.beans.actions.files.MoveFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.MoveFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>zdesktop.webapp/localstore.json</string>
                            </object>
                          </void>
                          <void property="overwriteMode">
                            <object class="com.install4j.api.context.OverwriteMode" field="ALWAYS" />
                          </void>
                          <void property="sourceFile">
                            <object class="java.io.File">
                              <string>localstore.json.bak</string>
                            </object>
                          </void>
                          <void property="triggerReboot">
                            <boolean>false</boolean>
                          </void>
                          <void property="uninstallMode">
                            <object class="com.install4j.api.context.UninstallMode" field="NEVER" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>String instDir = (String)context.getVariable("sys.installationDir");
return (new File(instDir + "/localstore.json.bak")).exists();</condition>
                  </action>
                </beans>
              </group>
              <action name="Set autoCheckUpdates" id="289510" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>String prefsFile = (String)context.getVariable("sys.installationDir") + "/profile/prefs.js";

try {
    BufferedReader reader = new BufferedReader(new FileReader(prefsFile));
    String line;
     while ((line = reader.readLine()) != null) {     
         if (line.indexOf("app.update.enabled") &gt; 0) {
             if (line.indexOf("false") &gt; 0 || line.indexOf("False") &gt; 0 || line.indexOf("FALSE") &gt; 0) {                                  
                 context.setVariable("autoCheckUpdates", false);
             }
             break;    
         }
     }
} catch (Exception e) {}

return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="delete old mailbox and zdesktop logs" id="289313" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import java.io.File;
import java.util.regex.Pattern;

String logDir = (String)context.getVariable("sys.installationDir") + "/log";
String[] files = (new File(logDir)).list();
Pattern p = Pattern.compile("zdesktop\\.log\\.\\d{4}-.+");

for (String file : files) {
    File f  = new File(logDir + "/" + file);
    try {
         if (f.isDirectory() || !f.canWrite())
             continue;
         if (file.indexOf("mailbox") &gt;= 0 || p.matcher(file).matches())
             f.delete();
    } catch (Exception e) {}
}

return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <group name="Start zdesktop" id="287724" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="false" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>Boolean.getBoolean("offline_update") &amp;&amp; !context.isErrorOccured()</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <action name="set launch var" id="287732" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>return Boolean.TRUE;</string>
                              </void>
                            </object>
                          </void>
                          <void property="variableName">
                            <string>launch</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Boolean.getBoolean("offline_update")</condition>
                  </action>
                  <action name="windows" id="287725" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="6">
                              <void index="0">
                                <string>-webapp</string>
                              </void>
                              <void index="1">
                                <string>${installer:sys.installationDir}\zdesktop.webapp</string>
                              </void>
                              <void index="2">
                                <string>-override</string>
                              </void>
                              <void index="3">
                                <string>${installer:sys.installationDir}\zdesktop.webapp\override.ini</string>
                              </void>
                              <void index="4">
                                <string>-profile</string>
                              </void>
                              <void index="5">
                                <string>${installer:sys.installationDir}\profile</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/win32/prism/prism.exe</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="stderrFile">
                            <object class="java.io.File">
                              <string>log/app.err</string>
                            </object>
                          </void>
                          <void property="stdoutFile">
                            <object class="java.io.File">
                              <string>log/app.out</string>
                            </object>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isWindows() &amp;&amp; context.getBooleanVariable("launch")</condition>
                  </action>
                  <action name="macos" id="287726" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="6">
                              <void index="0">
                                <string>-webapp</string>
                              </void>
                              <void index="1">
                                <string>${installer:sys.installationDir}/zdesktop.webapp</string>
                              </void>
                              <void index="2">
                                <string>-override</string>
                              </void>
                              <void index="3">
                                <string>${installer:sys.installationDir}/zdesktop.webapp/override.ini</string>
                              </void>
                              <void index="4">
                                <string>-profile</string>
                              </void>
                              <void index="5">
                                <string>${installer:sys.installationDir}/profile</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>macos/Yahoo! Zimbra Desktop.app/Contents/MacOS/prism</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="stderrFile">
                            <object class="java.io.File">
                              <string>log/app.err</string>
                            </object>
                          </void>
                          <void property="stdoutFile">
                            <object class="java.io.File">
                              <string>log/app.out</string>
                            </object>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("launch")</condition>
                  </action>
                  <action name="linux" id="287727" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="6">
                              <void index="0">
                                <string>-webapp</string>
                              </void>
                              <void index="1">
                                <string>${installer:sys.installationDir}/zdesktop.webapp</string>
                              </void>
                              <void index="2">
                                <string>-override</string>
                              </void>
                              <void index="3">
                                <string>${installer:sys.installationDir}/zdesktop.webapp/override.ini</string>
                              </void>
                              <void index="4">
                                <string>-profile</string>
                              </void>
                              <void index="5">
                                <string>${installer:sys.installationDir}/profile</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/linux/prism/prism</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="stderrFile">
                            <object class="java.io.File">
                              <string>log/app.err</string>
                            </object>
                          </void>
                          <void property="stdoutFile">
                            <object class="java.io.File">
                              <string>log/app.out</string>
                            </object>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS() &amp;&amp; context.getBooleanVariable("launch")</condition>
                  </action>
                </beans>
              </group>
            </actions>
            <formComponents />
          </screen>
          <screen name="Update Options" id="289491" beanClass="com.install4j.runtime.beans.screens.FormScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="3" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.FormScreen">
                  <void property="subTitle">
                    <string>${i18n:installer.UpdatesSubTitle}</string>
                  </void>
                  <void property="title">
                    <string>${i18n:installer.UpdatesTitle}</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!Boolean.getBoolean("offline_update")</condition>
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents>
              <formComponent name="Auto check updates" id="289494" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                      <void property="checkboxText">
                        <string>${i18n:installer.AutoCheckUpdates}</string>
                      </void>
                      <void property="variableName">
                        <string>autoCheckUpdates</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript>((JCheckBox)configurationObject).setSelected(context.getBooleanVariable("autoCheckUpdates"));
</initScript>
              </formComponent>
              <formComponent name="John Dev Prog" id="289492" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                      <void property="checkboxText">
                        <string>${i18n:installer.JoinDevProg}</string>
                      </void>
                      <void property="variableName">
                        <string>joinDevProgChecked</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript>((JCheckBox)configurationObject).setSelected(Boolean.valueOf((String) context.getVariable("joinDevProg")))</initScript>
              </formComponent>
              <formComponent name="John Dev Prog Note" id="289493" beanClass="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent">
                      <void property="labelHtml">
                        <string>${i18n:installer.JoinDevProgNote}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
            </formComponents>
          </screen>
          <screen name="" id="9" beanClass="com.install4j.runtime.beans.screens.FinishedScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="true">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.FinishedScreen">
                  <void property="bannerBackground">
                    <object class="java.awt.Color">
                      <int>255</int>
                      <int>255</int>
                      <int>255</int>
                      <int>255</int>
                    </object>
                  </void>
                  <void property="bannerImageFile">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./src/installer/resources/installer_banner.png</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition>!context.isErrorOccured()</condition>
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="Set auto update option" id="289502" beanClass="com.install4j.runtime.beans.actions.text.AppendToFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.AppendToFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>profile/user.js</string>
                        </object>
                      </void>
                      <void property="text">
                        <string>
user_pref("app.update.enabled", ${installer:autoCheckUpdates});
</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="set dev flag in installation info" id="289503" beanClass="com.install4j.runtime.beans.actions.text.AppendToFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.AppendToFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>conf/install.info</string>
                        </object>
                      </void>
                      <void property="text">
                        <string>dev=${installer:joinDevProg}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>if (!Boolean.getBoolean("offline_update")) {
    String s = context.getBooleanVariable("joinDevProgChecked") ? "true" : "false";
    context.setVariable("joinDevProg", s);
}
return true;</condition>
              </action>
              <group name="set update url" id="289504" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup" />
                  </java>
                </serializedBean>
                <beans>
                  <action name="set ausUrl" id="289505" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>String bos = Util.isWindows() ? "win32" : (Util.isMacOS() ? "macos" : "linux");
String loc="${installer:languageId}";
String key="${installer:instanceId}";
String url = ((String)context.getVariable("joinDevProg")).equals("true") ? 
    "${compiler:offline_ausurl_dev}" : "${compiler:offline_ausurl}";

url = url + "?chn=${compiler:offline_channel}&amp;ver=${compiler:offline_version}&amp;" + 
    "bid=${compiler:offline_buildid}&amp;bos=" + bos + "&amp;loc=" + loc + "&amp;key=" + key;
    
context.setVariable("ausUrl", url);
return true;</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="macos - preferences.js" id="289506" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>macos/prism/Prism.app/Contents/Resources/defaults/preferences/preferences.js</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>${installer:ausUrl}</string>
                          </void>
                          <void property="searchValue">
                            <string>@aus_url@</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isMacOS()</condition>
                  </action>
                  <action name="win32 - preferences.js" id="289507" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>win32/prism/defaults/preferences/preferences.js</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>${installer:ausUrl}</string>
                          </void>
                          <void property="searchValue">
                            <string>@aus_url@</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isWindows()</condition>
                  </action>
                  <action name="linux - preferences.js" id="289508" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="file">
                            <object class="java.io.File">
                              <string>linux/prism/extensions/prism-runtime@developer.mozilla.org/defaults/preferences/preferences.js</string>
                            </object>
                          </void>
                          <void property="replaceValue">
                            <string>${installer:ausUrl}</string>
                          </void>
                          <void property="searchValue">
                            <string>@aus_url@</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>!Util.isMacOS() &amp;&amp; !Util.isWindows()</condition>
                  </action>
                </beans>
              </group>
              <group name="Start zdesktop" id="287728" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string />
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <action name="windows" id="287729" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="6">
                              <void index="0">
                                <string>-webapp</string>
                              </void>
                              <void index="1">
                                <string>${installer:sys.installationDir}\zdesktop.webapp</string>
                              </void>
                              <void index="2">
                                <string>-override</string>
                              </void>
                              <void index="3">
                                <string>${installer:sys.installationDir}\zdesktop.webapp\override.ini</string>
                              </void>
                              <void index="4">
                                <string>-profile</string>
                              </void>
                              <void index="5">
                                <string>${installer:sys.installationDir}\profile</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/win32/prism/zdclient.exe</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="stderrFile">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/log/app.out</string>
                            </object>
                          </void>
                          <void property="stdoutFile">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/log/app.out</string>
                            </object>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isWindows() &amp;&amp; context.getBooleanVariable("launch")</condition>
                  </action>
                  <action name="macos" id="287730" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="6">
                              <void index="0">
                                <string>-webapp</string>
                              </void>
                              <void index="1">
                                <string>${installer:sys.installationDir}/zdesktop.webapp</string>
                              </void>
                              <void index="2">
                                <string>-override</string>
                              </void>
                              <void index="3">
                                <string>${installer:sys.installationDir}/zdesktop.webapp/override.ini</string>
                              </void>
                              <void index="4">
                                <string>-profile</string>
                              </void>
                              <void index="5">
                                <string>${installer:sys.installationDir}/profile</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>macos/Yahoo! Zimbra Desktop.app/Contents/MacOS/prism</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="stderrFile">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/log/app.out</string>
                            </object>
                          </void>
                          <void property="stdoutFile">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/log/app.out</string>
                            </object>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isMacOS() &amp;&amp; context.getBooleanVariable("launch")</condition>
                  </action>
                  <action name="linux" id="287731" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="6">
                              <void index="0">
                                <string>-webapp</string>
                              </void>
                              <void index="1">
                                <string>${installer:sys.installationDir}/zdesktop.webapp</string>
                              </void>
                              <void index="2">
                                <string>-override</string>
                              </void>
                              <void index="3">
                                <string>${installer:sys.installationDir}/zdesktop.webapp/override.ini</string>
                              </void>
                              <void index="4">
                                <string>-profile</string>
                              </void>
                              <void index="5">
                                <string>${installer:sys.installationDir}/profile</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/linux/prism/zdclient</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="stderrFile">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/log/app.out</string>
                            </object>
                          </void>
                          <void property="stdoutFile">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/log/app.out</string>
                            </object>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS() &amp;&amp; context.getBooleanVariable("launch")</condition>
                  </action>
                </beans>
              </group>
            </actions>
            <formComponents>
              <formComponent name="Launch" id="3856" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                      <void property="checkboxText">
                        <string>${i18n:installer.LaunchCheckbox}</string>
                      </void>
                      <void property="initiallySelected">
                        <boolean>true</boolean>
                      </void>
                      <void property="variableName">
                        <string>launch</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
            </formComponents>
          </screen>
        </screens>
      </application>
      <application name="" id="uninstaller" beanClass="com.install4j.runtime.beans.applications.UninstallerApplication" enabled="true" commentSet="false" comment="" customIcnsFile="./src/installer/resources/launcher_128x128.icns" customIcoFile="">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.applications.UninstallerApplication">
              <void property="customHeaderImage">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./src/installer/resources/installer_60x60.png</string>
                </object>
              </void>
              <void property="customPngIcon16File">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./src/installer/resources/launcher_16x16.png</string>
                </object>
              </void>
              <void property="customPngIcon32File">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./src/installer/resources/launcher_32x32.png</string>
                </object>
              </void>
              <void property="useCustomIcon">
                <boolean>true</boolean>
              </void>
            </object>
          </java>
        </serializedBean>
        <startup>
          <screen name="" id="16" beanClass="com.install4j.runtime.beans.screens.StartupScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.StartupScreen" />
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents />
          </screen>
        </startup>
        <screens>
          <screen name="" id="10" beanClass="com.install4j.runtime.beans.screens.UninstallWelcomeScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.UninstallWelcomeScreen">
                  <void property="bannerBackground">
                    <object class="java.awt.Color">
                      <int>255</int>
                      <int>255</int>
                      <int>255</int>
                      <int>255</int>
                    </object>
                  </void>
                  <void property="bannerImageFile">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./src/installer/resources/installer_banner.png</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents />
          </screen>
          <screen name="" id="109908" beanClass="com.install4j.runtime.beans.screens.AdditionalConfirmationsScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.AdditionalConfirmationsScreen" />
              </java>
            </serializedBean>
            <condition>true || !context.getBooleanVariable("wipeUserData")</condition>
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents>
              <formComponent name="" id="109909" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                      <void property="checkboxText">
                        <string>${i18n:installer.DelDataCheckbox}</string>
                      </void>
                      <void property="variableName">
                        <string>wipeUserData</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
              <formComponent name="" id="109911" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                      <void property="labelColor">
                        <object class="java.awt.Color">
                          <int>255</int>
                          <int>0</int>
                          <int>0</int>
                          <int>255</int>
                        </object>
                      </void>
                      <void property="labelText">
                        <string>${i18n:installer.MultilineLabel}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
              </formComponent>
            </formComponents>
          </screen>
          <screen name="" id="11" beanClass="com.install4j.runtime.beans.screens.UninstallationScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.UninstallationScreen" />
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="set userHome" id="286392" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>return Util.getUserHome();</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>userHome</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <group name="stop prism" id="287048" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup" />
                  </java>
                </serializedBean>
                <beans>
                  <action name="win and linux stop prism" id="288921" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="1">
                              <void index="0">
                                <string>${installer:prismBinaryArgs}</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:prismBinary}</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>if (Util.isMacOS())
    return false;
        
try {        
    String instDir = (String)context.getVariable("sys.installationDir");
    String oldBin;
    String newBin;
    if (Util.isWindows()) {
        oldBin = instDir + "\\win32\\prism\\prism.exe";
        newBin = instDir + "\\win32\\prism\\zdclient.exe";
    } else {
        oldBin = instDir + "/linux/prism/prism";
        newBin = instDir + "/linux/prism/zdclient";
    }
    
    if ((new File(oldBin)).exists())
        context.setVariable("prismBinary", oldBin);
    else if ((new File(newBin)).exists())
        context.setVariable("prismBinary", newBin);
    else
        return false;
    
    String[] args = new String []{"-override",  Util.isWindows() ? 
        (instDir + "\\zdesktop.webapp\\override.ini") : 
        (instDir + "/zdesktop.webapp/override.ini"), "-close"};
    context.setVariable("prismBinaryArgs", args);
    return true;
} catch (Exception e) {
    return false;
}
   </condition>
                  </action>
                  <action name="macos stop prism" id="287049" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="1">
                              <void index="0">
                                <string>${installer:sys.installationDir}/macos/quit_zdesktop.applescript</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>/usr/bin/osascript</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isMacOS()</condition>
                  </action>
                </beans>
              </group>
              <action name="" id="95843" beanClass="com.install4j.runtime.beans.actions.services.StopServiceAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.services.StopServiceAction">
                      <void property="launcherId">
                        <string>32</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>!Util.isMacOS()</condition>
              </action>
              <action name="stop macos service" id="5382" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>stop</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>zdesktop</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <group name="kill service" id="287046" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup" />
                  </java>
                </serializedBean>
                <beans>
                  <action name="win32 kill service" id="287054" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="2">
                              <void index="0">
                                <string>svckill.vbs</string>
                              </void>
                              <void index="1">
                                <string>//b</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:sys.system32Dir}/cscript.exe</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>win32</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isWindows()</condition>
                  </action>
                  <action name="macos kill service" id="287053" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="1">
                              <void index="0">
                                <string>${installer:sys.installationDir}/macos/svckill.msh</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>/bin/sh</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isMacOS()</condition>
                  </action>
                  <action name="linux kill service" id="287052" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/linux/svckill.sh</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>log</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>!Util.isWindows() &amp;&amp; !Util.isMacOS()</condition>
                  </action>
                </beans>
              </group>
              <action name="launchctl remove" id="145683" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="2">
                          <void index="0">
                            <string>remove</string>
                          </void>
                          <void index="1">
                            <string>com.zimbra.zdesktop</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>/bin/launchctl</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="clear error" id="285708" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>context.setErrorOccured(false);
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="jetty/work" id="95844" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>jetty/work</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="lib" id="95858" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>lib</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="conf" id="95848" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="false" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>conf</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="db" id="95852" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>db</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="zimlets" id="271563" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>zimlets</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="profile" id="95856" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>profile</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="zdesktop.webapp" id="271564" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>zdesktop.webapp</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="log" id="95851" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>log</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("wipeUserData")</condition>
              </action>
              <action name="redolog" id="95850" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>redolog</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("wipeUserData")</condition>
              </action>
              <action name="store" id="95849" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>store</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("wipeUserData")</condition>
              </action>
              <action name="index" id="95857" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>index</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("wipeUserData")</condition>
              </action>
              <action name="derby" id="109912" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>derby</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("wipeUserData")</condition>
              </action>
              <action name="" id="12" beanClass="com.install4j.runtime.beans.actions.UninstallFilesAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.UninstallFilesAction" />
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="windows links" id="284692" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>File desktop = new File(WinFileSystem.getSpecialFolder(SpecialFolder.DESKTOP, false), "Yahoo! Zimbra Desktop.lnk");
File startmenu = new File(WinFileSystem.getSpecialFolder(SpecialFolder.STARTMENU, false), "Yahoo! Zimbra Desktop.lnk");

if (desktop.exists())
    desktop.delete();

if (startmenu.exists())
    startmenu.delete();
    
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isWindows()</condition>
              </action>
              <action name="delete mac app dir" id="286266" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="backupForRollback">
                        <boolean>false</boolean>
                      </void>
                      <void property="file">
                        <object class="java.io.File">
                          <string>/Applications/Yahoo! Zimbra Desktop.app</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
              <action name="delete mac desktop icon" id="286394" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="backupForRollback">
                        <boolean>false</boolean>
                      </void>
                      <void property="file">
                        <object class="java.io.File">
                          <string>${installer:userHome}/Desktop/Yahoo! Zimbra Desktop.app</string>
                        </object>
                      </void>
                      <void property="recurse">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isMacOS()</condition>
              </action>
            </actions>
            <formComponents />
          </screen>
          <screen name="" id="14" beanClass="com.install4j.runtime.beans.screens.UninstallFailureScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="true">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.UninstallFailureScreen" />
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents />
          </screen>
          <screen name="" id="13" beanClass="com.install4j.runtime.beans.screens.UninstallSuccessScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="true">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.UninstallSuccessScreen">
                  <void property="bannerBackground">
                    <object class="java.awt.Color">
                      <int>255</int>
                      <int>255</int>
                      <int>255</int>
                      <int>255</int>
                    </object>
                  </void>
                  <void property="bannerImageFile">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./src/installer/resources/installer_banner.png</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents />
          </screen>
        </screens>
      </application>
    </applications>
  </installerGui>
  <mediaSets>
    <win32 name="Windows" id="198394" mediaFileName="${compiler:sys.shortName}_${compiler:offline_version}_build_${compiler:offline_buildid}_win32" installDir="zdesktop" overridePrincipalLanguage="false" requires64bit="false" runPostProcessor="false" postProcessor="" failOnPostProcessorError="false" includedJRE="windows-x86-1.5.0_15" manualJREEntry="false" bundleType="1" jreURL="" jreFtpURL="" jreShared="false" customInstallBaseDir="" createUninstallIcon="true" contentFilesType="1" downloadURL="" runAsAdmin="true">
      <excludedLaunchers />
      <excludedComponents />
      <excludedBeans />
      <overriddenPrincipalLanguage id="en" customLocalizationFile="" />
      <exclude>
        <entry location="macos" fileType="regular" />
        <entry location="linux" fileType="regular" />
      </exclude>
      <variables />
    </win32>
    <unixInstaller name="Unix" id="59040" mediaFileName="${compiler:sys.shortName}_${compiler:offline_version}_build_${compiler:offline_buildid}_linux_i686" installDir="zdesktop" overridePrincipalLanguage="false" requires64bit="false" runPostProcessor="false" postProcessor="" failOnPostProcessorError="false" includedJRE="linux-x86-1.5.0_15" manualJREEntry="false" bundleType="1" jreURL="" jreFtpURL="" jreShared="false" customInstallBaseDir="~/zimbra" createUninstallIcon="true" contentFilesType="1" downloadURL="">
      <excludedLaunchers />
      <excludedComponents />
      <excludedBeans />
      <overriddenPrincipalLanguage id="en" customLocalizationFile="" />
      <exclude>
        <entry location="win32" fileType="regular" />
        <entry location="macos" fileType="regular" />
      </exclude>
      <variables />
      <installerScript mode="1" file="">
        <scriptLines />
      </installerScript>
    </unixInstaller>
    <macosFolder name="Mac OS X Intel" id="44" mediaFileName="${compiler:sys.shortName}_${compiler:offline_version}_build_${compiler:offline_buildid}_macos_intel" installDir="zdesktop" overridePrincipalLanguage="false" requires64bit="false" runPostProcessor="false" postProcessor="" failOnPostProcessorError="false" customInstallBaseDir="~/zimbra" createUninstallIcon="true" contentFilesType="1" downloadURL="">
      <excludedLaunchers />
      <excludedComponents />
      <excludedBeans />
      <overriddenPrincipalLanguage id="en" customLocalizationFile="" />
      <exclude>
        <entry location="win32" fileType="regular" />
        <entry location="linux" fileType="regular" />
      </exclude>
      <variables />
    </macosFolder>
  </mediaSets>
  <buildIds buildAll="false">
    <mediaSet refId="44" />
  </buildIds>
</install4j>

